# This script is an edited version of the example found at
# https://git.ligo.org/lscsoft/example-ci-project/blob/python/.gitlab-ci.yml
# Each 0th-indendation level is a job that will be run within GitLab CI
# The only exception are a short list of reserved keywords
#
# https://docs.gitlab.com/ee/ci/yaml/#gitlab-ci-yml

# stages is a reserved keyword that defines job dependencies and
# parallelization. each stage runs in parallel but must complete
# before the next stage begins

language: python

python:
  - "2.7"
  - "3.6"

cache: pip

install:
  - pip install -r requirements.txt
  - pip install -r pages_requirements.txt
  - pip install flake8 pytest-cov coverage-badge
  - pip install .

script:
  - flake8 .
  
  - export PYTHONPATH='.' 
  - pytest --cov=gwpopulation
    
after_script:
  - coverage html
  - coverage-badge -o coverage_badge.svg -f

before_deploy:
  - cd docs
  - make clean
  - make html

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
  keep-history: true
  on:
    branch: master
    condition: python="3.6"
